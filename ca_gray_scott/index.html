<!doctype html>
<html>
    <head>
        <title>Cellular Automata: Gray-Scott Reaction-Diffusion Model</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" value="A writeup on a cellular automata model of Gray-Scott Reaction-Diffusion pattern formation with an interactive demo.">
        <link rel="stylesheet" href="../style.css">
        <link rel="stylesheet" href="style.css">
        <script type="text/javascript" src="../lib/LaTeXMathML.js"></script>
    </head>
    <body>
        <main class="page-width">
            <article class="page-article">
                <header>
                    <div class="header-inner"><a id="date" href="../index.html">許實驗室</a> Minh Hua's Blog</div>
                    <nav class="menu">
                        <ul class="menu-inner">
                            <li><a href="../index.html">blog</a></li>
                            <li><a href="https://github.com/duyminh1998" target="_blank" rel="noopener noreferrer">github</a></li>
                            <li><a href="https://scholar.google.com/citations?user=dB862eQAAAAJ&hl=en" target="_blank" rel="noopener noreferrer">google scholar</a></li>
                            <li><a href="../about/about.html">about</a></li>
                        </ul>
                    </nav>
                </header>                
                <div class="meta-info">
                    <h1>Cellular Automata: Gray-Scott Reaction-Diffusion Model</h1>
                    <hr>
                    <a id="date">02-24-2023</a>
                </div>
                <div id="toc_container">
                    <h2>Contents</h2>
                    <ul class="toc_list">
                    <li><a href="#intro-head">1 Introduction</a></li>
                    <li><a href="#background-head">2 Background</a>
                      <ul>
                        <li><a href="#rd-sys-head">2.1 Reaction-Diffusion systems</a></li>
                        <li><a href="#gs-model-head">2.2 The Gray-Scott model</a></li>
                        <li><a href="#ca-model-head">2.3 Cellular Automata implementation</a></li>
                        <li><a href="#sample-patterns-head">2.4 Sample patterns</a></li>
                      </ul>                       
                    </li>
                    <li><a href="#interactive-exercise">3 Interactive walkthrough</a></li>
                    </ul>
                </div>
                <h2 id="intro-head">Introduction</h2>
                <p>During the last term of my M.S. in Computer Science program at Johns Hopkins, I took an Independent Study course with Dr. Wiley focused on Cellular Automata (CA). We investigated a total of five CA models, and this blog post serves as the second in a series of several documentations of those projects. The first post was on Thomas Schelling's model of segregation, and you can find it <a href="https://minhhua.com/ca_schelling/" target="_blank" rel="noopener noreferrer">here</a>. In this post, I will present a CA implementation of a particularly interesting reaction-diffusion system known as the Gray-Scott model.</p>

                <h2 id="background-head">Background</h2>
                <h3 id="rd-sys-head">Reaction-Diffusion systems</h3>
                <p>The <a href="https://en.wikipedia.org/wiki/Reaction%E2%80%93diffusion_system" target="_blank" rel="noopener noreferrer">Wikipedia page</a> on reaction-diffusion systems has a good high-level explanation that I will reformulate in my own words. Reaction-diffusion systems are mathematical models (usually involving partial differential equations) that are used to model physical phenomena in chemistry, biology, geology, physics, and ecology. Perhaps the most famous example of these systems is the evolution of the concentration of one or more chemical substances across space and time. These changes involve chemical <i>reactions</i> between the substances and their <i>diffusion</i> over a surface in space.</p>
                <p>One motivation for studying reaction-diffusion systems is the formation of patterns that can arise from certain models. Just like the segregation of populations that arose from the simple rules in Schelling's model of segregation, so too can complex and beautiful patterns arise from reaction-diffusion systems like Turing's patterns, the <i>Belousov-Zhabotinsky</i> (BZ) reaction, and the Gray-Scott model. The patterns that arise from these mathematical models and their simulations often resemble things like animal coats and skin pigmentation in nature, leading to the argument that reaction-diffusion processes might be the foundation for certain <a href="https://en.wikipedia.org/wiki/Morphogenesis" target="_blank" rel="noopener noreferrer">morphogenic</a> processes in biology. In addition, we are motivated to study certain reaction-diffusion systems due to the trippy images that get generated.</p>

                <h3 id="gs-model-head">The Gray-Scott model</h3>
                <p>The Gray-Scott model is based on a chemical reaction model developed by Peter Gray and Steven Scott in the 1980s [<a href="https://knightscholar.geneseo.edu/oer-ost/14/" target="_blank" rel="noopener noreferrer">1</a>]. The chemical reaction takes one molecule of a substance $u$ and two molecules of a substance $v$ and turns it into three molecules of $v$. The chemical equation is</p> 
                <p><center>$u + 2v \to 3v$</center></p>
                <p>$u$ is continuously replenished from an external source at a feed rate $F$, while $v$ is removed from the system at a rate $k$ slightly faster than $F$. Then, the dynamics of the Gray-Scott model are given by the system of equations</p>
                <p><center>$\frac{\partial u}{\partial t} = F(1 - u) - uv^2 + D_u \nabla^2 u$</center></p>
                <p><center>$\frac{\partial v}{\partial t} = -(F+k)v + uv^2 + D_v \nabla^2 v$</center></p>
                <p>The second term in the two equations above describe the aforementioned chemical reaction in that $u$ is consumed to produce $v$. The third term in the two equations describe the diffusion of the chemical substances, such that $D_u$ and $D_v$ describe the diffusion rates of $u$ and $v$.</p>             

                <h3 id="ca-model-head">Cellular Automata implementation</h3>
                <p>To simulate the Gray-Scott model using cellular automata (CA), we will use a two-dimensional grid to represent the concentrations of $u$ and $v$ at each timestep. Each chemical will have their own grid, but the grids interact with each other according to the differential equations. Each cell represents some arbitrary point in space, and the value at the cell, ranging from 0 to 1, determines the concentration of the substance at that location. The main dynamics we want to observe is the diffusion of the substances across the grid over time. We will use von Neumann neighborhoods and periodic boundary conditions for the CA model.</p>
                <p>The state of each cell is updated by solving the differential equations at each timestep using numerical techniques. A simple strategy we adopt is the Euler method, where we calculate the value of a function at the next timestep by adding the value of the function at the current timestep to the derivative of the function times a step size. In other words, to calculate the concentration of a substance at the next timestep, we add the current concentration to the differential equation that describes the rate of change of the substance times a step size (plus a diffusion term). For our CA model, the update rule can be conceptually split into two parts. In the first part, we determine the diffusion at each cell by considering the cell's four closest neighbors (von Neumann neighborhood), namely</p> 
                <p><center>$D[u(x, y, t+1)] = u(x + 1, y, t) + u(x, y + 1, t) + u(x - 1, y, t) + u(x, y - 1, t) - 4u(x, j, t)$</center></p>
                <p>In the equation above, $x$ and $y$ are the coordinates of a substance $u$, and $t$ describes the current timestep. In the second part, the chemical reaction terms $F(1 - u) - uv^2$ and $-(F+k)v + uv^2$ from the differential equations are computed as</p> 
                <p><center>$R[u(x, y, t+1)] = -u(x, y, t)\cdot v(x,y,t)^2 + F\cdot (1 - u(x,y,t))$</center></p>
                <p><center>$R[v(x, y, t+1)] = u(x, y, t)\cdot v(x,y,t)^2 - (F + k)\cdot v(x,y,t)$</center></p>
                <p>Then, the update rules can be summarized as</p>
                <p><center>$u(x,y,t+1)=u(x,y,t)+D_u \cdot D[u(x, y, t+1)] + R[u(x, y, t+1)]$</center></p>
                <p><center>$v(x,y,t+1)=v(x,y,t)+D_v \cdot D[v(x, y, t+1)] + R[v(x, y, t+1)]$</center></p>
                <p>One final note we make is that these simulations can often take a very long time due to the large number of cells and the calculations involved. As a result, we borrow from <a href="https://github.com/gouarin" target="_blank" rel="noopener noreferrer">@gouarin</a>'s efficient <a href="https://pnavaro.github.io/python-fortran/06.gray-scott-model.html" target="_blank" rel="noopener noreferrer">implementation</a> of the Gray-Scott model using numpy (we use <a href="https://www.npmjs.com/package/numjs" target="_blank" rel="noopener noreferrer">numjs</a> instead).</p>
                
                <h3 id="sample-patterns-head">Sample patterns</h3>
                <p>Here are some of my favorite patterns and the parameters that generated them.</p>

                <h2 id="interactive-exercise">Interactive walkthrough</h2>
                <p>To run the simulation, first use the input boxes on the left to tweak the parameters. The first four input boxes correspond to the feed rate, kill rate, and diffusion rates of the system. Since it can sometimes be hard to find a combination of parameters that produce an interesting pattern, users can also insert preset parameters using the <b>Sample parameters</b> dropdown menu. The <b>Frames</b> and <b>Steps per frame</b>> parameters can be used to tweak the smoothness of the animation. Since diffusion often happens slowly, users are encouraged to use a larger number of timesteps per frame. The <b>Delay</b> control determines the delay between each frame when playing the animation. Finally, the <b>Board size</b> slider controls the number of individuals in the configuration. The <b>Chemical type</b> dropdown can be used to display the chemical type (V is usually the more interesting one). Finally, users can also use <b>Initial conditions</b> to choose between several different initial conditions.</p>
                <p>After selecting the parameters, click on the <b>Generate</b> button to generate the animation. Since the simulation can take a long time to complete, this demo works by first generating all the frames for the animation and then playing them afterwards for a smoother experience. After the animation is done generating, press the <b>Play</b> button to play the animation. The <b>Pause</b> button can be used to pause the animation, and the <b>Cancel</b> button can be used to stop the generation of an animation.</p>
                
                <div class="table-container">
                    <table class="board" id="config-table"></table>
                </div>
                <div id="ca-gray-scott-walkthrough-control-box">
                    <div style="display: flex; flex-direction: column">
                        <div>
                          <a id="animation-gen-status">Idle</a>
                        </div>
                        <!-- <div>
                          <a id="animation-frame">Frame 0</a>
                        </div> -->
                    </div>
                    <div class="btn-containers" id="ca-gray-scott-btn-containers">
                      <button type="button" class="ca-gray-scott-btns" id="reset-board-btn">Reset</button>
                      <button type="button" class="ca-gray-scott-btns" id="start-btn" style="width: 75px;">Generate</button>
                      <button type="button" class="ca-gray-scott-btns" id="cancel-btn" style="width: 60px;">Cancel</button>
                      <button type="button" class="ca-gray-scott-btns" id="play-btn">Play</button>
                      <button type="button" class="ca-gray-scott-btns" id="pause-btn">Pause</button>              
                    </div>
                    <div class="ca-gray-scott-controls">
                      <div class="inputs-container">
                        <div class="input-container">
                          <a>$F$: </a>
                          <input type="text" value="0.03" class="slider" id="F-range">
                        </div>
                        <div class="input-container">
                          <a>$k$: </a>
                          <input type="text" value="0.06" class="slider" id="k-range">
                        </div>
                        <div class="input-container">
                          <a>$D_u$: </a>
                          <input type="text" value="0.16" class="slider" id="du-range">
                        </div>
                        <div class="input-container">
                          <a>$D_v$: </a>
                          <input type="text" value="0.03" class="slider" id="dv-range">
                        </div>
                        <div class="input-container">
                          <a>Frames: </a>
                          <input type="text" value="100" class="slider" id="n-frames-range">
                        </div>
                        <div class="input-container">
                          <a>Steps per frame: </a>
                          <input type="text" value="10" class="slider" id="steps-per-frame-range">
                        </div>                  
                        <div class="input-container">
                          <a>Delay<a id="delay-intext">(0ms)</a></a>
                          <input type="range" min="0" max="3000" value="0" class="slider" id="delay-range">
                        </div>
                        <div class="input-container">
                          <a>Board size<a id="board-size-intext">(100x100)</a></a>
                          <input type="range" min="10" max="200" value="100" class="slider" id="board-size-range">
                        </div>
                      </div>
                      <div class="dropdowns-container">
                        <div class="dropdown-container" id="chemical-type-dropdown-container">
                          <label for="chemical-type">Chemical type: </label>
                          <select name="chemical-type" id="chemical-type">
                            <option value="u-chem" >U</option>
                            <option value="v-chem" selected>V</option>
                          </select>
                        </div>
                        <div class="dropdown-container" id="init-cond-dropdown-container">
                          <label for="init-cond">Initial conditions: </label>
                          <select name="init-cond" id="init-cond">
                            <option value="center square" selected>center square</option>
                            <option value="center point">center point</option>
                            <option value="random">random</option>
                          </select>
                        </div>
                        <div class="dropdown-container" id="sample-params-dropdown-container">
                          <label for="sample-params">Sample parameters: </label>
                          <select name="sample-params" id="sample-params">
                            <option value=0 selected>0.03 | 0.06 | 0.16 | 0.03</option>
                            <option value=1>0.03 | 0.06 | 0.16 | 0.08</option>
                            <option value=2>0.06 | 0.03 | 0.16 | 0.08</option>
                            <option value=3>0.014 | 0.039 | 0.16 | 0.08</option>
                            <option value=4>0.06 | 0.062 | 0.16 | 0.08</option>
                            <option value=5>0.04 | 0.062 | 0.16 | 0.08</option>
                            <option value=6>0.02 | 0.057 | 0.16 | 0.08</option>
                          </select>
                        </div>                        
                      </div>
                    </div>
                </div>                
            
            <div class="copyright"><a href="#">Back to top</a><br> © 2023 Minh Hua</div>  

            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
            <script src="https://cdn.jsdelivr.net/gh/nicolaspanel/numjs@0.15.1/dist/numjs.min.js"></script>
            <script type="text/javascript" src="demo.js"></script>
            </article>
        </main>
    </body>
</html>
