<!doctype html>
<html>
    <head>
        <title>ARM immediate value encoding for dummies</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" value="A more in-depth tutorial on how to encode numbers using ARM immediate value encoding. Intended as a companion to Alisdair McDiarmid's excellent blog post on the same topic.">
        <link rel="stylesheet" href="../style.css">
    </head>
    <body>
        <main class="page-width">
            <article class="page-article">
                <header>
                    <div class="header-inner"><a id="date" href="../index.html">許實驗室</a> Minh Hua's Blog</div>
                    <nav class="menu">
                        <ul class="menu-inner">
                            <li><a href="../index.html">blog</a></li>
                            <li><a href="https://github.com/duyminh1998" target="_blank" rel="noopener noreferrer">github</a></li>
                            <li><a href="https://scholar.google.com/citations?user=dB862eQAAAAJ&hl=en" target="_blank" rel="noopener noreferrer">google scholar</a></li>
                            <li><a href="../about/about.html">about</a></li>
                        </ul>
                    </nav>
                </header>                
                <div class="meta-info">
                    <h1>ARM immediate value encoding ... for dummies</h1>
                    <hr>
                    <a id="date">11-11-2021</a>
                </div>

                <h2>Introduction</h2>
                <p>During the first term of my M.S. in Computer Science program at Johns Hopkins, I took Foundations of Computer Architecture with Dr. Kann. He had a list of final projects that we could do, one of which was to develop an interactive tool to teach students about the immediate Operand2 encoding that are on the ARM chips. This blog is intended to be 
                    a companion to Alisdair McDiarmid's excellent <a href="https://alisdair.mcdiarmid.org/arm-immediate-value-encoding/" target="_blank" rel="noopener noreferrer">blog post</a> on the same topic. The only difference being that the interactive tool presented here goes into much more detail on the steps taken to encode a number.</p>
                <h2>Motivation</h2>
                <p>The motivation for this tool is to present to students a step-by-step approach to learning and visualizing how ARM encodes immediate values longer than 8 bits using the flexible Operand2 immediate encoding.</p>
                <p>Before you begin the exercise, you should refer to Alisdair McDiarmid's <a href="https://alisdair.mcdiarmid.org/arm-immediate-value-encoding/" target="_blank" rel="noopener noreferrer">blog post</a> for a refresher on machine code and ARM instructions. For convenience, I reproduce the most important piece of information below.</p>
                <p>ARM uses bits 0-11 of an instruction to represent an immediate, but it does not represent the full number in 12 bits. In fact, the <a style="color: #FC83FC;"> bottom 8 bits </a> are used to represent the number while the <a style="color: #A7BCFD;"> top 4 bits </a> are used to capture a <a href="https://en.wikipedia.org/wiki/Circular_shift" target="_blank" rel="noopener noreferrer">rotation</a> amount. </p> 
                <div class="temp-bits-container" style="display: flex; justify-content: center;">
                    <div class="bits-container">
                        <div class="bits" id="example-bits-0" style="color: #A7BCFD;">1</div>
                        <div class="bits" id="example-bits-1" style="color: #A7BCFD;">0</div>
                        <div class="bits" id="example-bits-2" style="color: #A7BCFD;">1</div>
                        <div class="bits" id="example-bits-3" style="color: #A7BCFD;">1</div>
                        <div class="bits" id="example-bits-4" style="color: #FC83FC;">1</div>
                        <div class="bits" id="example-bits-5" style="color: #FC83FC;">1</div>
                        <div class="bits" id="example-bits-6" style="color: #FC83FC;">1</div>
                        <div class="bits" id="example-bits-7" style="color: #FC83FC;">1</div>
                        <div class="bits" id="example-bits-8" style="color: #FC83FC;">1</div>
                        <div class="bits" id="example-bits-9" style="color: #FC83FC;">1</div>
                        <div class="bits" id="example-bits-10" style="color: #FC83FC;">1</div>
                        <div class="bits" id="example-bits-11" style="color: #FC83FC;">1</div>                               
                    </div>
                </div>
                <p>The main idea behind the encoding is to shift the most significant parts of the original number into the bottom 8 bits and then use the 4-bit rotation amount to reconstruct the number by rotating the 8-bit number that amount to the right until we get the original number. Thus, a requirement for encoding a number in this fashion is that you must be able to cram the most significant parts of the number into 8 bits. Informally, significance denotes the longest span of bits that starts and ends with a 1. 
                    Think about significance as preserving the number using 8 bits. If you moved the most significant portions of the number into the 8-bit "bucket", chopped off the rest of the bits, then you should still be able to reconstruct the number by moving it back to its original position. </p>
                <p>For example, consider the number 261120. Its 32-bit binary representation is 00000000000000<a style="color: #FC83FC;">11111111</a>0000000000. If I only preserved the string of 1s starting at bit 10 and ending at bit 17 (which are 8 bits), I can still reconstruct the number if I knew the original position of this 8-bit string. Thus, an alternate way to encode this is to say that 261120 is 11111111, where the first 1 is at bit 10 and the last 1 is at bit 17. ARM immediate encoding is very similar in that it also captures the significant bits 
                    but instead of encoding the raw position of the 8 bits in the original number, it encodes that information in a rotation amount. Observe that the 8-bit number 11111111 extended to be 32 bits 000000000000000000000000<a style="color: #FC83FC;">11111111</a> and then <a style="color: #A7BCFD;"> rotated 22 times </a> to the right gets you back to 00000000000000<a style="color: #FC83FC;">11111111</a>0000000000, the original number.
                </p> 

                <h2 id="interactive-exercise">Interactive walkthrough</h2>
                <p>The goal of this interactive walkthrough is to go through the steps of encoding a number into the 12 bits that is used to represent an immediate in an ARM instruction. Recall that the immediate part of an ARM instruction is 12 bits, with 8 bits reserved for the number and 4 bits reserved for a right rotation amount. If your number can be represented with 8 bits, then we do not need to perform any extra rotation because we can just use the 8 bits available to us. Otherwise, we have to perform some more manipulation to our bits. </p> 
                <p>To get started, please enter a number you want to encode into the input box below. The raw binary representation of your number should then populate in the 32 bits below the input box. You can try a base-10 number or a hex number prepended with 0x.</p>

                <p>Example numbers to try: <a href="" id="ex-261120" onclick="App.update();">261120</a>, <a href="" id="ex-0x102" onclick="App.update();">0x102</a>, <a href="" id="ex-0xFF0000FF" onclick="App.update();">0xFF0000FF</a>, <a href="" id="ex-0xC0000034" onclick="App.update();">0xC0000034</a></p>
                <form action="" class="input-form">
                    <label for="val-input">Enter your number here: </label>
                    <input type="text" class="val-input">
                </form>
                <p id="your-num-is"></p>
                <div class="bits-container">
                    <div class="bits" id="input-bits-0">1</div>
                    <div class="bits" id="input-bits-1">1</div>
                    <div class="bits" id="input-bits-2">0</div>
                    <div class="bits" id="input-bits-3">0</div>
                    <div class="bits" id="input-bits-4">1</div>
                    <div class="bits" id="input-bits-5">0</div>
                    <div class="bits" id="input-bits-6">0</div>
                    <div class="bits" id="input-bits-7">1</div>
                    <div class="bits" id="input-bits-8">0</div>
                    <div class="bits" id="input-bits-9">0</div>
                    <div class="bits" id="input-bits-10">1</div>
                    <div class="bits" id="input-bits-11">0</div>
                    <div class="bits" id="input-bits-12">0</div>
                    <div class="bits" id="input-bits-13">1</div>
                    <div class="bits" id="input-bits-14">0</div>
                    <div class="bits" id="input-bits-15">0</div>
                    <div class="bits" id="input-bits-16">1</div>
                    <div class="bits" id="input-bits-17">0</div>
                    <div class="bits" id="input-bits-18">1</div>
                    <div class="bits" id="input-bits-19">0</div>
                    <div class="bits" id="input-bits-20">0</div>
                    <div class="bits" id="input-bits-21">1</div>
                    <div class="bits" id="input-bits-22">0</div>
                    <div class="bits" id="input-bits-23">0</div>
                    <div class="bits" id="input-bits-24" style="fill-opacity: 0.5; color: #7ED321;">1</div>
                    <div class="bits" id="input-bits-25" style="fill-opacity: 0.5; color: #7ED321;">0</div>
                    <div class="bits" id="input-bits-26" style="fill-opacity: 0.5; color: #7ED321;">0</div>
                    <div class="bits" id="input-bits-27" style="fill-opacity: 0.5; color: #7ED321;">1</div>
                    <div class="bits" id="input-bits-28" style="fill-opacity: 0.5; color: #7ED321;">0</div>
                    <div class="bits" id="input-bits-29" style="fill-opacity: 0.5; color: #7ED321;">0</div>
                    <div class="bits" id="input-bits-30" style="fill-opacity: 0.5; color: #7ED321;">1</div>
                    <div class="bits" id="input-bits-31" style="fill-opacity: 0.5; color: #7ED321;">0</div>                                  
                </div>

                <!-- <div class="continue-buttons">
                    <button type="button" class="cont-btn" id="cont-yes">YES</button>
                    <button type="button" class="cont-btn" id="cont-no">NO</button>                     
                </div> -->

                <div class="continue-container"></div>
                <div class="continue-to-rot-container"></div>
                <div class="copyright"><a href="#">Back to top</a><br> © 2021 Minh Hua</div>

                <script id="og-input-bits-template" type="text/template">
                    <div class="bits-container" id="show-og-bits-container">
                        <div class="bits" id="show-input-bits-0">1</div>
                        <div class="bits" id="show-input-bits-1">1</div>
                        <div class="bits" id="show-input-bits-2">0</div>
                        <div class="bits" id="show-input-bits-3">0</div>
                        <div class="bits" id="show-input-bits-4">1</div>
                        <div class="bits" id="show-input-bits-5">0</div>
                        <div class="bits" id="show-input-bits-6">0</div>
                        <div class="bits" id="show-input-bits-7">1</div>
                        <div class="bits" id="show-input-bits-8">0</div>
                        <div class="bits" id="show-input-bits-9">0</div>
                        <div class="bits" id="show-input-bits-10">1</div>
                        <div class="bits" id="show-input-bits-11">0</div>
                        <div class="bits" id="show-input-bits-12">0</div>
                        <div class="bits" id="show-input-bits-13">1</div>
                        <div class="bits" id="show-input-bits-14">0</div>
                        <div class="bits" id="show-input-bits-15">0</div>
                        <div class="bits" id="show-input-bits-16">1</div>
                        <div class="bits" id="show-input-bits-17">0</div>
                        <div class="bits" id="show-input-bits-18">1</div>
                        <div class="bits" id="show-input-bits-19">0</div>
                        <div class="bits" id="show-input-bits-20">0</div>
                        <div class="bits" id="show-input-bits-21">1</div>
                        <div class="bits" id="show-input-bits-22">0</div>
                        <div class="bits" id="show-input-bits-23">0</div>
                        <div class="bits" id="show-input-bits-24">1</div>
                        <div class="bits" id="show-input-bits-25">0</div>
                        <div class="bits" id="show-input-bits-26">0</div>
                        <div class="bits" id="show-input-bits-27">1</div>
                        <div class="bits" id="show-input-bits-28">0</div>
                        <div class="bits" id="show-input-bits-29">0</div>
                        <div class="bits" id="show-input-bits-30">1</div>
                        <div class="bits" id="show-input-bits-31">0</div>                                  
                    </div>
                </script>

                <script id="continue-no-template" type="text/template">
                    <div class="dynamic-content">
                        <div class="get-correct-8-bits-containter">
                            <hr style="background: white; height: 1px; border: #333;">
                            <p>Your number is longer than 8-bits. The red highlights the number of significant bits that are out of the valid 8-bit bucket. Therefore, we need to capture the most significant parts of our number and move them into the bottom 8 bits that are available to us. Use the arrow buttons to move the significant portions of the number into bits 0-7.</p> 
                            <div class="bits-container">
                                <div class="bits" id="find-cor-bits-0">1</div>
                                <div class="bits" id="find-cor-bits-1">1</div>
                                <div class="bits" id="find-cor-bits-2">0</div>
                                <div class="bits" id="find-cor-bits-3">0</div>
                                <div class="bits" id="find-cor-bits-4">1</div>
                                <div class="bits" id="find-cor-bits-5">0</div>
                                <div class="bits" id="find-cor-bits-6">0</div>
                                <div class="bits" id="find-cor-bits-7">1</div>
                                <div class="bits" id="find-cor-bits-8">0</div>
                                <div class="bits" id="find-cor-bits-9">0</div>
                                <div class="bits" id="find-cor-bits-10">1</div>
                                <div class="bits" id="find-cor-bits-11">0</div>
                                <div class="bits" id="find-cor-bits-12">0</div>
                                <div class="bits" id="find-cor-bits-13">1</div>
                                <div class="bits" id="find-cor-bits-14">0</div>
                                <div class="bits" id="find-cor-bits-15">0</div>
                                <div class="bits" id="find-cor-bits-16">1</div>
                                <div class="bits" id="find-cor-bits-17">0</div>
                                <div class="bits" id="find-cor-bits-18">1</div>
                                <div class="bits" id="find-cor-bits-19">0</div>
                                <div class="bits" id="find-cor-bits-20">0</div>
                                <div class="bits" id="find-cor-bits-21">1</div>
                                <div class="bits" id="find-cor-bits-22">0</div>
                                <div class="bits" id="find-cor-bits-23">0</div>
                                <div class="bits" id="find-cor-bits-24" style="color: #7ED321;">1</div>
                                <div class="bits" id="find-cor-bits-25" style="color: #7ED321;">0</div>
                                <div class="bits" id="find-cor-bits-26" style="color: #7ED321;">0</div>
                                <div class="bits" id="find-cor-bits-27" style="color: #7ED321;">1</div>
                                <div class="bits" id="find-cor-bits-28" style="color: #7ED321;">0</div>
                                <div class="bits" id="find-cor-bits-29" style="color: #7ED321;">0</div>
                                <div class="bits" id="find-cor-bits-30" style="color: #7ED321;">1</div>
                                <div class="bits" id="find-cor-bits-31" style="color: #7ED321;">0</div>                                   
                            </div>
                            <div class="btn-containers" style="margin-bottom: 10px;">
                                <button type="button" class="lr-arrows" id="find-cor-bits-left-arrow">&lt</button>
                                <button type="button" class="lr-arrows" id="find-cor-bits-right-arrow">&gt</button>
                            </div>
                            <p> If you cannot fit the significant portions of the number into the bottom 8 bits, then you will not be able to encode the number. Usually, this is either because the significant portion is longer than 8 bits, or it requires an odd rotation. Remember that the rotation amount has to be an even number from zero to 30.</p>                       
                        </div>
                    </div>
                </script>

                <script id="continue-yes-template" type="text/template">
                    <hr style="background: white; height: 1px; border: #333;">
                    <p>Your number can be represented with less than or equals to 8 bits. You may end the exercise here.</p>
                </script>

                <script id="continue-to-rot-template" type="text/template">
                    <div class="rot-back-to-og-container">
                        <hr style="background: white; height: 1px; border: #333;">
                        <p>The bits that you rotated into bits 0-7 equals <a id="8-bit-equals"></a>, and you have just fit the most significant parts of your original number into 8 bits. Therefore, <a id="8-bit-equals-2"></a> or 0b<a id="8-bit-equals-bit"></a> will be going into the bottom 8 bits of the ARM instruction. However, <a id="8-bit-equals-3"></a> is not the original number, and this is where the rotation comes in. To reconstruct the original number, notice that we can just rotate those 8 bits (e.g. 0b<a id="8-bit-equals-bit-2"></a>) back to their original position. Therefore, we need to determine the amount of right rotation needed to get back to the original position of the bits in the original value. Use the "Show original value" button to reveal the original value
                        to see if you have been able to match it. Use the provided right arrow key for rotation and the reset button if you went too far.</p>
                        <div class="btn-containers"><button type="button" id="show-og-bits-btn" style="margin-bottom: 10px; background-color: #333; border: 1px solid white; color: white;">Show original value</button></div>
                        <div class="og-input-bits"></div>
                        <div class="bits-container">
                            <div class="bits" id="rot-back-bits-0">1</div>
                            <div class="bits" id="rot-back-bits-1">1</div>
                            <div class="bits" id="rot-back-bits-2">0</div>
                            <div class="bits" id="rot-back-bits-3">0</div>
                            <div class="bits" id="rot-back-bits-4">1</div>
                            <div class="bits" id="rot-back-bits-5">0</div>
                            <div class="bits" id="rot-back-bits-6">0</div>
                            <div class="bits" id="rot-back-bits-7">1</div>
                            <div class="bits" id="rot-back-bits-8">0</div>
                            <div class="bits" id="rot-back-bits-9">0</div>
                            <div class="bits" id="rot-back-bits-10">1</div>
                            <div class="bits" id="rot-back-bits-11">0</div>
                            <div class="bits" id="rot-back-bits-12">0</div>
                            <div class="bits" id="rot-back-bits-13">1</div>
                            <div class="bits" id="rot-back-bits-14">0</div>
                            <div class="bits" id="rot-back-bits-15">0</div>
                            <div class="bits" id="rot-back-bits-16">1</div>
                            <div class="bits" id="rot-back-bits-17">0</div>
                            <div class="bits" id="rot-back-bits-18">1</div>
                            <div class="bits" id="rot-back-bits-19">0</div>
                            <div class="bits" id="rot-back-bits-20">0</div>
                            <div class="bits" id="rot-back-bits-21">1</div>
                            <div class="bits" id="rot-back-bits-22">0</div>
                            <div class="bits" id="rot-back-bits-23">0</div>
                            <div class="bits" id="rot-back-bits-24">1</div>
                            <div class="bits" id="rot-back-bits-25">0</div>
                            <div class="bits" id="rot-back-bits-26">0</div>
                            <div class="bits" id="rot-back-bits-27">1</div>
                            <div class="bits" id="rot-back-bits-28">0</div>
                            <div class="bits" id="rot-back-bits-29">0</div>
                            <div class="bits" id="rot-back-bits-30">1</div>
                            <div class="bits" id="rot-back-bits-31">0</div>                                     
                        </div>
                        <div class="btn-containers" style="margin-bottom: 2px">
                            <button type="button" class="lr-arrows" id="rot-back-right-arrow">&gt</button>
                            <button type="button" class="lr-arrows" id="rot-back-reset">Reset</button>
                        </div>
                        <p id="rot-amt-blurb"> You have rotated the bottom 8 bits 0 times to the right.</p>
                        <hr style="background: white; height: 1px; border: #333;">
                        <p id="correct-answer"></p>
                        <div id="animation-container"></div>                        
                    </div>                    
                </script>

                <script id="play-animation-template" type="text/template">
                    <h2>Animation</h2>
                    <p id="pre-animation-blurb">Here's a visualization of how ARM reconstructs</p>
                    <div class="btn-containers">
                        <button type="button" id="play-animation-btn" style="margin-bottom: 10px; background-color: #333; border: 1px solid white; color: white;">Play animation</button>
                    </div>
                    <div class="bits-container">
                        <div class="bits" id="animation-bits-0">1</div>
                        <div class="bits" id="animation-bits-1">1</div>
                        <div class="bits" id="animation-bits-2">0</div>
                        <div class="bits" id="animation-bits-3">0</div>
                        <div class="bits" id="animation-bits-4">1</div>
                        <div class="bits" id="animation-bits-5">0</div>
                        <div class="bits" id="animation-bits-6">0</div>
                        <div class="bits" id="animation-bits-7">1</div>
                        <div class="bits" id="animation-bits-8">0</div>
                        <div class="bits" id="animation-bits-9">0</div>
                        <div class="bits" id="animation-bits-10">1</div>
                        <div class="bits" id="animation-bits-11">0</div>
                        <div class="bits" id="animation-bits-12">0</div>
                        <div class="bits" id="animation-bits-13">1</div>
                        <div class="bits" id="animation-bits-14">0</div>
                        <div class="bits" id="animation-bits-15">0</div>
                        <div class="bits" id="animation-bits-16">1</div>
                        <div class="bits" id="animation-bits-17">0</div>
                        <div class="bits" id="animation-bits-18">1</div>
                        <div class="bits" id="animation-bits-19">0</div>
                        <div class="bits" id="animation-bits-20">0</div>
                        <div class="bits" id="animation-bits-21">1</div>
                        <div class="bits" id="animation-bits-22">0</div>
                        <div class="bits" id="animation-bits-23">0</div>
                        <div class="bits" id="animation-bits-24">1</div>
                        <div class="bits" id="animation-bits-25">0</div>
                        <div class="bits" id="animation-bits-26">0</div>
                        <div class="bits" id="animation-bits-27">1</div>
                        <div class="bits" id="animation-bits-28">0</div>
                        <div class="bits" id="animation-bits-29">0</div>
                        <div class="bits" id="animation-bits-30">1</div>
                        <div class="bits" id="animation-bits-31">0</div>                                     
                    </div>
                    <p id="animation-blurb"></p>                    
                </script>

            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
            <script type="text/javascript" src="demo.js"></script>
            </article>
        </main>
    </body>
</html>
